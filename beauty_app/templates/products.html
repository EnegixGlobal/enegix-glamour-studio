{% extends 'base.html' %}
{% load static %}

{% block title %}Our Products — Glamour Studio{% endblock %}
{% block nav_products %}active{% endblock %}

{% block extra_css %}
<style>
.page-hero {
    height: 50vh; min-height: 360px;
    background: url('https://images.unsplash.com/photo-1596462502278-27bfdc403348?w=1920&q=80') center/cover no-repeat;
    position: relative;
    display: flex; align-items: flex-end;
    padding-bottom: 60px; padding-top: 100px;
}
.page-hero-content { position: relative; z-index: 2; }
.page-hero-title {
    font-family: var(--font-serif);
    font-size: clamp(2.5rem, 5vw, 4rem);
    color: var(--champagne);
    font-weight: 300; line-height: 1.1;
}
.breadcrumb-glamour a { color: var(--rose-gold); font-size:0.78rem; letter-spacing:1px; }
.breadcrumb-glamour span { color: rgba(247,231,206,0.5); font-size:0.78rem; margin:0 8px; }
.breadcrumb-glamour .current { color: rgba(247,231,206,0.75); font-size:0.78rem; }

.products-main { padding: 80px 0 100px; }

/* Product Grid Card */
.product-g-card {
    background: var(--white);
    box-shadow: var(--shadow-card);
    overflow: hidden;
    transition: var(--transition);
    height: 100%;
    display: flex; flex-direction: column;
}
.product-g-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 16px 50px rgba(59,15,43,0.15);
}
.product-g-img {
    height: 260px; overflow: hidden; position: relative;
}
.product-g-img img {
    width: 100%; height: 100%;
    object-fit: cover;
    transition: transform 0.7s ease;
}
.product-g-card:hover .product-g-img img { transform: scale(1.1); }
.product-g-overlay {
    position: absolute; inset: 0;
    background: rgba(59,15,43,0.55);
    display: flex; flex-direction:column;
    align-items: center; justify-content: center;
    gap: 10px;
    opacity: 0; transition: var(--transition);
}
.product-g-card:hover .product-g-overlay { opacity: 1; }
.product-low-stock {
    position: absolute; top: 12px; left: 12px;
    background: #c0392b;
    color: white;
    font-size: 0.6rem; letter-spacing: 1px;
    text-transform: uppercase;
    padding: 3px 8px;
}
.product-g-body {
    padding: 20px 22px;
    flex: 1; display: flex; flex-direction: column;
}
.product-g-brand {
    font-size: 0.65rem; letter-spacing: 2px;
    text-transform: uppercase; color: var(--rose-gold);
    margin-bottom: 6px; display: block;
}
.product-g-name {
    font-family: var(--font-serif);
    font-size: 1.1rem; color: var(--plum);
    margin-bottom: 8px; flex: 1;
}
.product-g-cat {
    font-size: 0.68rem; letter-spacing: 1px;
    text-transform: uppercase; color: var(--text-mid);
    margin-bottom: 14px;
}
.product-g-footer {
    display: flex; justify-content: space-between;
    align-items: center;
    padding-top: 14px;
    border-top: 1px solid rgba(59,15,43,0.07);
}
.product-g-price {
    font-family: var(--font-serif);
    font-size: 1.3rem; color: var(--plum);
}

/* Product Modal */
.product-modal .modal-content { border: none; border-radius: 0; }
.product-modal .modal-header {
    background: var(--plum); border: none;
    padding: 24px 30px;
}
.product-modal .modal-title {
    font-family: var(--font-serif);
    color: var(--champagne); font-size: 1.5rem; font-weight: 400;
}
.product-modal .modal-body { padding: 0; background: var(--bg-warm); }
.product-modal-img {
    width: 100%; height: 320px;
    object-fit: cover; display: block;
}
.product-modal-details { padding: 30px; }
.product-modal-price {
    font-family: var(--font-serif);
    font-size: 2rem; color: var(--plum);
    margin: 12px 0;
}
.product-modal-desc {
    font-size: 0.9rem; color: var(--text-mid);
    line-height: 1.9;
}
.enquiry-badge {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(59,15,43,0.06);
    border: 1px solid rgba(59,15,43,0.12);
    padding: 10px 16px;
    font-size: 0.8rem; color: var(--text-mid);
    margin-top: 20px;
}

@media (max-width: 768px) {
    .page-hero {
        height: auto; min-height: 280px;
        padding-bottom: 40px; padding-top: 100px;
    }
    .page-hero-title { font-size: clamp(2rem, 8vw, 3rem) !important; }
    .products-main { padding: 50px 0 60px !important; }

    .product-g-img { height: 200px; }
    .product-g-body { padding: 14px 16px; }
    .product-g-name { font-size: 0.98rem; }
    .product-g-price { font-size: 1.1rem; }

    /* Modal */
    .product-modal .modal-header { padding: 18px 20px; }
    .product-modal .modal-title { font-size: 1.2rem; }
    .product-modal-img { height: 220px; }
    .product-modal-details { padding: 20px; }
    .product-modal-price { font-size: 1.6rem; }
    .product-modal .modal-dialog { margin: 10px; }

    /* Modal buttons */
    .product-modal-details .d-flex.gap-3 { flex-direction: column; gap: 10px !important; }
    .product-modal-details .d-flex.gap-3 a { text-align: center; }

    .enquiry-badge { flex-wrap: wrap; }
}

@media (max-width: 575px) {
    /* On xs screens, 2 columns already (col-6), make images taller */
    .product-g-img { height: 160px; }
    .product-g-body { padding: 12px 12px; }
    .product-g-name { font-size: 0.9rem; }
    .product-g-price { font-size: 1rem; }
    .product-g-footer { flex-wrap: wrap; gap: 8px; }
    .product-g-footer .btn-glamour-rose { width: 100%; text-align: center; font-size: 0.6rem; padding: 6px 10px; }
}
</style>
{% endblock %}

{% block content %}

<!-- PAGE HERO -->
<div class="page-hero">
    <div class="overlay overlay-plum"></div>
    <div class="container page-hero-content">
        <div class="breadcrumb-glamour mb-12" style="margin-bottom:12px;">
            <a href="{% url 'home' %}">Home</a>
            <span>›</span>
            <span class="current">Our Products</span>
        </div>
        <span class="section-label">Our Collection</span>
        <h1 class="page-hero-title">Premium<br>Beauty Products</h1>
    </div>
</div>

<!-- PRODUCTS MAIN -->
<section class="products-main">
    <div class="container">
        <div class="text-center mb-5" data-aos="fade-up">
            <span class="section-label">Browse by Category</span>
            <h2 class="section-title">Shop Our Collection</h2>
            <div class="section-divider"></div>
        </div>

        <!-- CATEGORY FILTER TABS -->
        <div class="glamour-tabs" data-aos="fade-up">
            <button class="glamour-tab-btn {% if active_category == 'all' %}active{% endif %}"
                    onclick="filterProducts('all')">All Products</button>
            {% for cat_value, cat_label in categories %}
            <button class="glamour-tab-btn {% if active_category == cat_value %}active{% endif %}"
                    onclick="filterProducts('{{ cat_value }}')">
                {{ cat_label }}
            </button>
            {% endfor %}
        </div>

        <!-- PRODUCTS GRID -->
        <div class="row g-4" id="productsGrid">
            {% for product in products %}
            <div class="col-lg-3 col-md-4 col-6 product-item"
                 data-category="{{ product.category }}"
                 data-aos="fade-up"
                 data-aos-delay="{{ forloop.counter0|add:1|stringformat:'d' }}00">
                <div class="product-g-card">
                    <div class="product-g-img">
                        {% if product.product_image %}
                        <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}">
                        {% else %}
                        <img src="https://images.unsplash.com/photo-1619451334792-150fd785ee74?w=600&q=80"
                             alt="{{ product.product_name }}">
                        {% endif %}

                        {% if product.is_low_stock %}
                        <span class="product-low-stock">Low Stock</span>
                        {% endif %}

                        <div class="product-g-overlay">
                            <button class="btn-glamour-outline"
                                    style="font-size:0.68rem; padding:10px 22px;"
                                    onclick="openProductModal(
                                        '{{ product.product_name|escapejs }}',
                                        '{{ product.brand|default:''|escapejs }}',
                                        '{{ product.description|escapejs }}',
                                        '{{ product.price }}',
                                        '{{ product.get_category_display }}',
                                        '{% if product.product_image %}{{ product.product_image.url }}{% endif %}'
                                    )">
                                Quick View
                            </button>
                            <a href="https://wa.me/919876543210?text=Hi!%20I%20want%20to%20enquire%20about%20{{ product.product_name|urlencode }}"
                               class="btn-glamour-rose"
                               style="font-size:0.68rem; padding:10px 22px;"
                               target="_blank">
                                Enquire Now
                            </a>
                        </div>
                    </div>
                    <div class="product-g-body">
                        {% if product.brand %}<span class="product-g-brand">{{ product.brand }}</span>{% endif %}
                        <div class="product-g-name">{{ product.product_name }}</div>
                        <div class="product-g-cat">{{ product.get_category_display }}</div>
                        <div class="product-g-footer">
                            <div class="product-g-price">₹{{ product.price }}</div>
                            <button class="btn-glamour-rose"
                                    style="font-size:0.65rem; padding:8px 16px;"
                                    onclick="openProductModal(
                                        '{{ product.product_name|escapejs }}',
                                        '{{ product.brand|default:''|escapejs }}',
                                        '{{ product.description|escapejs }}',
                                        '{{ product.price }}',
                                        '{{ product.get_category_display }}',
                                        '{% if product.product_image %}{{ product.product_image.url }}{% endif %}'
                                    )">
                                Details
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5" id="noProductsMsg">
                <i class="bi bi-bag-heart" style="font-size:2.5rem; color:var(--rose-gold); display:block; margin-bottom:16px;"></i>
                <p style="color:var(--text-mid);">No products available at the moment. Check back soon.</p>
            </div>
            {% endfor %}
        </div>

        <!-- Empty state for JS filter -->
        <div id="productEmptyMsg" class="text-center py-5" style="display:none;">
            <i class="bi bi-bag-x" style="font-size:2.5rem; color:var(--rose-gold); display:block; margin-bottom:16px;"></i>
            <p style="color:var(--text-mid);">No products found in this category.</p>
        </div>
    </div>
</section>


<!-- PRODUCT MODAL -->
<div class="modal fade product-modal" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pModalName">Product Name</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        style="filter:invert(1) sepia(1) saturate(0);"></button>
            </div>
            <div class="modal-body">
                <div class="row g-0">
                    <div class="col-md-5">
                        <img id="pModalImg"
                             src="https://images.unsplash.com/photo-1619451334792-150fd785ee74?w=600&q=80"
                             alt="Product" class="product-modal-img">
                    </div>
                    <div class="col-md-7">
                        <div class="product-modal-details">
                            <span id="pModalBrand" class="product-g-brand" style="font-size:0.7rem;"></span>
                            <div class="product-modal-price">₹<span id="pModalPrice"></span></div>
                            <span id="pModalCat" class="product-g-cat"></span>
                            <div style="height:1px; background:rgba(59,15,43,0.1); margin:16px 0;"></div>
                            <p class="product-modal-desc" id="pModalDesc"></p>

                            <div class="enquiry-badge">
                                <i class="bi bi-info-circle" style="color:var(--rose-gold);"></i>
                                This product is available in-salon. Contact us to enquire.
                            </div>

                            <div class="d-flex gap-3 mt-4">
                                <a id="pModalWa" href="#" target="_blank" class="btn-glamour-primary" style="font-size:0.7rem; padding:12px 24px;">
                                    <span><i class="fab fa-whatsapp me-2"></i>WhatsApp Enquiry</span>
                                </a>
                                <a href="{% url 'contact' %}" class="btn-glamour-outline" style="font-size:0.7rem; padding:12px 24px; color:var(--plum); border-color:var(--plum);">
                                    Contact Us
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function filterProducts(category) {
    document.querySelectorAll('.glamour-tab-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    const items = document.querySelectorAll('.product-item');
    let visibleCount = 0;

    items.forEach(item => {
        if (category === 'all' || item.dataset.category === category) {
            item.style.display = 'block';
            visibleCount++;
        } else {
            item.style.display = 'none';
        }
    });

    document.getElementById('productEmptyMsg').style.display = visibleCount === 0 ? 'block' : 'none';

    const url = new URL(window.location);
    if (category === 'all') {
        url.searchParams.delete('category');
    } else {
        url.searchParams.set('category', category);
    }
    window.history.pushState({}, '', url);

    AOS.refresh();
}

function openProductModal(name, brand, desc, price, category, imgUrl) {
    document.getElementById('pModalName').textContent = name;
    document.getElementById('pModalBrand').textContent = brand || '';
    document.getElementById('pModalDesc').textContent = desc;
    document.getElementById('pModalPrice').textContent = price;
    document.getElementById('pModalCat').textContent = category;

    if (imgUrl) {
        document.getElementById('pModalImg').src = imgUrl;
    } else {
        document.getElementById('pModalImg').src = 'https://images.unsplash.com/photo-1619451334792-150fd785ee74?w=600&q=80';
    }

    const msg = encodeURIComponent(`Hi! I'd like to enquire about: ${name} (₹${price})`);
    document.getElementById('pModalWa').href = `https://wa.me/919876543210?text=${msg}`;

    new bootstrap.Modal(document.getElementById('productModal')).show();
}
</script>
{% endblock %}
